<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="ExDoc v0.30.3">
    <meta name="project" content="bonfire_umbrella v0.9.5-classic-beta.29">

    <title>EctoSparkles â€” bonfire_umbrella v0.9.5-classic-beta.29</title>
    <link rel="stylesheet" href="dist/html-elixir-P5GXSCHE.css" />


    <script src="dist/handlebars.runtime-NWIB6V2M.js"></script>
    <script src="dist/handlebars.templates-NBND3S2D.js"></script>
    <script src="dist/sidebar_items-149F4B69.js"></script>

      <script src="docs_config.js"></script>

    <script async src="dist/html-CGDDOCMI.js"></script>


  </head>
  <body data-type="modules" class="page-module">
    <script>

      try {
        var settings = JSON.parse(localStorage.getItem('ex_doc:settings') || '{}');

        if (settings.theme === 'dark' ||
           ((settings.theme === 'system' || settings.theme == null) &&
             window.matchMedia('(prefers-color-scheme: dark)').matches)
           ) {
          document.body.classList.add('dark')
        }
      } catch (error) { }
    </script>

<div class="main">

<button class="sidebar-button sidebar-toggle" aria-label="toggle sidebar">
  <i class="ri-menu-line ri-lg" title="Collapse/expand sidebar"></i>
</button>

<section class="sidebar">
  <form class="sidebar-search" action="search.html">
    <button type="submit" class="search-button" aria-label="Submit Search">
      <i class="ri-search-2-line" aria-hidden="true" title="Submit search"></i>
    </button>
    <button type="button" tabindex="-1" class="search-close-button" aria-label="Cancel Search">
      <i class="ri-close-line ri-lg" aria-hidden="true" title="Cancel search"></i>
    </button>
    <label class="search-label">
      <p class="sr-only">Search</p>
      <input name="q" type="text" class="search-input" placeholder="Search..." aria-label="Input your search terms" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" />
    </label>
  </form>

  <div class="autocomplete">
    <div class="autocomplete-results">
    </div>
  </div>

  <div class="sidebar-header">

      <a href="https://bonfirenetworks.org">
        <img src="assets/logo.png" alt="bonfire_umbrella" class="sidebar-projectImage">
      </a>

    <div class="sidebar-projectDetails">
      <a href="https://bonfirenetworks.org" class="sidebar-projectName" translate="no">
bonfire_umbrella
      </a>
      <div class="sidebar-projectVersion" translate="no">
        v0.9.5-classic-beta.29
      </div>
    </div>
    <ul class="sidebar-listNav">
      <li><a id="extras-list-link" href="#full-list">Pages</a></li>

        <li><a id="modules-list-link" href="#full-list">Modules</a></li>


        <li><a id="tasks-list-link" href="#full-list"><span translate="no">Mix</span> Tasks</a></li>

    </ul>
  </div>

  <div class="gradient"></div>
  <ul id="full-list"></ul>
</section>

<section class="content">
  <output role="status" id="toast"></output>
  <div class="content-outer">
    <div id="content" class="content-inner">

<h1>
<button class="icon-action display-settings">
  <i class="ri-settings-3-line"></i>
  <span class="sr-only">Settings</span>
</button>


    <a href="https://github.com/bonfire-networks/ecto_sparkles/blob/main/lib/ecto_sparkles.ex#L2" title="View Source" class="icon-action" rel="help">
      <i class="ri-code-s-slash-line" aria-hidden="true"></i>
      <span class="sr-only">View Source</span>
    </a>

  <span translate="no">EctoSparkles</span> 
  <small class="app-vsn" translate="no">(bonfire_umbrella v0.9.5-classic-beta.29)</small>

</h1>


  <section id="moduledoc">
<p><code class="inline">query_filter</code> brings convenience and shortens the boilterplate of ecto queries</p><p>Common filters available include:</p><ul><li><code class="inline">preload</code> - Preloads fields onto the query results</li><li><code class="inline">start_date</code> - Query for items inserted after this date</li><li><code class="inline">end_date</code> - Query for items inserted before this date</li><li><code class="inline">before</code> - Get items with IDs before this value</li><li><code class="inline">after</code> - Get items with IDs after this value</li><li><code class="inline">ids</code> - Get items with a list of ids</li><li><code class="inline">first</code> - Gets the first n items</li><li><code class="inline">last</code> - Gets the last n items</li><li><code class="inline">limit</code> - Gets the first n items</li><li><code class="inline">offset</code> - Offsets limit by n items</li><li><code class="inline">search</code> - <strong><em>Warning:</em></strong> This requires schemas using this to have a <code class="inline">&amp;by_search(query, val)</code> function</li></ul><p>You are also able to filter on any natural field of a model, as well as use</p><ul><li>gte/gt</li><li>lte/lt</li><li>like/ilike</li><li>is_nil/not(is_nil)</li></ul><pre><code class="makeup elixir" translate="no"><span class="n">query_filter</span><span class="p" data-group-id="7065450010-1">(</span><span class="nc">User</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7065450010-2">%{</span><span class="ss">name</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="7065450010-3">%{</span><span class="ss">ilike</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;steve&quot;</span><span class="p" data-group-id="7065450010-3">}</span><span class="p" data-group-id="7065450010-2">}</span><span class="p" data-group-id="7065450010-1">)</span><span class="w">
</span><span class="n">query_filter</span><span class="p" data-group-id="7065450010-4">(</span><span class="nc">User</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7065450010-5">%{</span><span class="ss">name</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="7065450010-6">%{</span><span class="ss">ilike</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;steve&quot;</span><span class="p" data-group-id="7065450010-6">}</span><span class="p" data-group-id="7065450010-5">}</span><span class="p">,</span><span class="w"> </span><span class="ss">:last_name</span><span class="p">,</span><span class="w"> </span><span class="ss">:asc</span><span class="p" data-group-id="7065450010-4">)</span><span class="w">
</span><span class="n">query_filter</span><span class="p" data-group-id="7065450010-7">(</span><span class="nc">User</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7065450010-8">%{</span><span class="ss">name</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="7065450010-9">%{</span><span class="ss">age</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="7065450010-10">%{</span><span class="ss">gte</span><span class="p">:</span><span class="w"> </span><span class="mi">18</span><span class="p">,</span><span class="w"> </span><span class="ss">lte</span><span class="p">:</span><span class="w"> </span><span class="mi">30</span><span class="p" data-group-id="7065450010-10">}</span><span class="p" data-group-id="7065450010-9">}</span><span class="p" data-group-id="7065450010-8">}</span><span class="p" data-group-id="7065450010-7">)</span><span class="w">
</span><span class="n">query_filter</span><span class="p" data-group-id="7065450010-11">(</span><span class="nc">User</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7065450010-12">%{</span><span class="ss">name</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="7065450010-13">%{</span><span class="ss">is_banned</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="7065450010-14">%{</span><span class="ss">!=</span><span class="p">:</span><span class="w"> </span><span class="no">nil</span><span class="p" data-group-id="7065450010-14">}</span><span class="p" data-group-id="7065450010-13">}</span><span class="p" data-group-id="7065450010-12">}</span><span class="p" data-group-id="7065450010-11">)</span><span class="w">
</span><span class="n">query_filter</span><span class="p" data-group-id="7065450010-15">(</span><span class="nc">User</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7065450010-16">%{</span><span class="ss">name</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="7065450010-17">%{</span><span class="ss">is_banned</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="7065450010-18">%{</span><span class="ss">==</span><span class="p">:</span><span class="w"> </span><span class="no">nil</span><span class="p" data-group-id="7065450010-18">}</span><span class="p" data-group-id="7065450010-17">}</span><span class="p" data-group-id="7065450010-16">}</span><span class="p" data-group-id="7065450010-15">)</span><span class="w">

</span><span class="n">my_query</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">query_filter</span><span class="p" data-group-id="7065450010-19">(</span><span class="nc">User</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7065450010-20">%{</span><span class="ss">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Billy&quot;</span><span class="p" data-group-id="7065450010-20">}</span><span class="p" data-group-id="7065450010-19">)</span><span class="w">
</span><span class="n">query_filter</span><span class="p" data-group-id="7065450010-21">(</span><span class="n">my_query</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7065450010-22">%{</span><span class="ss">last_name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Joe&quot;</span><span class="p" data-group-id="7065450010-22">}</span><span class="p" data-group-id="7065450010-21">)</span></code></pre>
  </section>


  <section id="summary" class="details-list">
    <h1 class="section-heading">
      <a class="hover-link" href="#summary">
        <i class="ri-link-m" aria-hidden="true"></i>
        Summary
      </a>
    </h1>
<div class="summary-functions summary">
  <h2>
    <a href="#functions">Functions</a>
  </h2>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#join_preload/2" translate="no">join_preload(query, associations)</a>

      </div>

        <div class="summary-synopsis"><p><code class="inline">join_preload</code> is a helper for preloading associations using joins.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#proload/3" translate="no">proload(query, qual \\ :left, associations)</a>

      </div>

        <div class="summary-synopsis"><p>AKA <code class="inline">join_preload++</code>. It's more powerful, but it does it with more (and different!) syntax.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#query_filter/4" translate="no">query_filter(module_or_query, filters, order_by_prop \\ :id, order_direction \\ :desc)</a>

      </div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#reusable_join/5" translate="no">reusable_join(query, qual \\ :left, bindings, expr, opts)</a>

      </div>

        <div class="summary-synopsis"><p><code class="inline">reusable_join</code> is similar to <code class="inline">Ecto.Query.join/{4,5}</code>, but can be called multiple times with the same alias.</p></div>

    </div>

</div>

  </section>


  <section id="functions" class="details-list">
    <h1 class="section-heading">
      <a class="hover-link" href="#functions">
        <i class="ri-link-m" aria-hidden="true"></i>
Functions
      </a>
    </h1>
    <div class="functions-list">
<section class="detail" id="join_preload/2">

  <div class="detail-header">
    <a href="#join_preload/2" class="detail-link" title="Link to this macro">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this macro</span>
    </a>
    <h1 class="signature" translate="no">join_preload(query, associations)</h1>

      <a href="https://github.com/bonfire-networks/ecto_sparkles/blob/main/lib/ecto_sparkles.ex#L81" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


      <span class="note">(macro)</span>

  </div>

  <section class="docstring">

<p><code class="inline">join_preload</code> is a helper for preloading associations using joins.</p><p>By default, Ecto preloads associations using a separate query for each association, which can degrade performance.
You could make it run faster by using a combination of join/preload, but that requires a bit of boilerplate (see example below).</p><p>With <a href="https://hexdocs.pm/ecto_sparkles/0.1.0/EctoSparkles.html#content"><code class="inline">EctoSparkles</code></a>, you can accomplish this with just one line of code.</p><h2 id="join_preload/2-example-using-just-ecto" class="section-heading">
  <a href="#join_preload/2-example-using-just-ecto">
    <i class="ri-link-m" aria-hidden="true"></i>
    Example using just Ecto
  </a>
</h2>
<pre><code class="makeup elixir" translate="no"><span class="kn">import</span><span class="w"> </span><span class="nc">Ecto.Query</span><span class="w">
</span><span class="nc">Invoice</span><span class="w">
</span><span class="o">|&gt;</span><span class="w"> </span><span class="n">join</span><span class="p" data-group-id="4101289351-1">(</span><span class="ss">:left</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4101289351-2">[</span><span class="n">i</span><span class="p" data-group-id="4101289351-2">]</span><span class="p">,</span><span class="w"> </span><span class="n">assoc</span><span class="p" data-group-id="4101289351-3">(</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="ss">:customer</span><span class="p" data-group-id="4101289351-3">)</span><span class="p">,</span><span class="w"> </span><span class="ss">as</span><span class="p">:</span><span class="w"> </span><span class="ss">:customer</span><span class="p" data-group-id="4101289351-1">)</span><span class="w">
</span><span class="o">|&gt;</span><span class="w"> </span><span class="n">join</span><span class="p" data-group-id="4101289351-4">(</span><span class="ss">:left</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4101289351-5">[</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="p" data-group-id="4101289351-5">]</span><span class="p">,</span><span class="w"> </span><span class="n">assoc</span><span class="p" data-group-id="4101289351-6">(</span><span class="n">c</span><span class="p">,</span><span class="w"> </span><span class="ss">:account</span><span class="p" data-group-id="4101289351-6">)</span><span class="p">,</span><span class="w"> </span><span class="ss">as</span><span class="p">:</span><span class="w"> </span><span class="ss">:account</span><span class="p" data-group-id="4101289351-4">)</span><span class="w">
</span><span class="o">|&gt;</span><span class="w"> </span><span class="n">join</span><span class="p" data-group-id="4101289351-7">(</span><span class="ss">:left</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4101289351-8">[</span><span class="n">i</span><span class="p" data-group-id="4101289351-8">]</span><span class="p">,</span><span class="w"> </span><span class="n">assoc</span><span class="p" data-group-id="4101289351-9">(</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="ss">:lines</span><span class="p" data-group-id="4101289351-9">)</span><span class="p">,</span><span class="w"> </span><span class="ss">as</span><span class="p">:</span><span class="w"> </span><span class="ss">:lines</span><span class="p" data-group-id="4101289351-7">)</span><span class="w">
</span><span class="o">|&gt;</span><span class="w"> </span><span class="n">preload</span><span class="p" data-group-id="4101289351-10">(</span><span class="p" data-group-id="4101289351-11">[</span><span class="ss">lines</span><span class="p">:</span><span class="w"> </span><span class="n">v</span><span class="p">,</span><span class="w"> </span><span class="ss">customers</span><span class="p">:</span><span class="w"> </span><span class="n">c</span><span class="p">,</span><span class="w"> </span><span class="ss">account</span><span class="p">:</span><span class="w"> </span><span class="n">a</span><span class="p" data-group-id="4101289351-11">]</span><span class="p">,</span><span class="w"> </span><span class="ss">lines</span><span class="p">:</span><span class="w"> </span><span class="n">v</span><span class="p">,</span><span class="w"> </span><span class="ss">customer</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="4101289351-12">{</span><span class="n">c</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4101289351-13">[</span><span class="ss">a</span><span class="p">:</span><span class="w"> </span><span class="n">account</span><span class="p" data-group-id="4101289351-13">]</span><span class="p" data-group-id="4101289351-12">}</span><span class="p" data-group-id="4101289351-10">)</span><span class="w">
</span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Repo</span><span class="o">.</span><span class="n">all</span><span class="p" data-group-id="4101289351-14">(</span><span class="p" data-group-id="4101289351-14">)</span></code></pre><h2 id="join_preload/2-example-using-join_preload" class="section-heading">
  <a href="#join_preload/2-example-using-join_preload">
    <i class="ri-link-m" aria-hidden="true"></i>
    Example using <code class="inline">join_preload</code>
  </a>
</h2>
<pre><code class="makeup elixir" translate="no"><span class="kn">import</span><span class="w"> </span><span class="nc">EctoSparkles</span><span class="w">
</span><span class="nc">Invoice</span><span class="w">
</span><span class="o">|&gt;</span><span class="w"> </span><span class="n">join_preload</span><span class="p" data-group-id="6762318847-1">(</span><span class="p" data-group-id="6762318847-2">[</span><span class="ss">:customer</span><span class="p">,</span><span class="w"> </span><span class="ss">:account</span><span class="p" data-group-id="6762318847-2">]</span><span class="p" data-group-id="6762318847-1">)</span><span class="w">
</span><span class="o">|&gt;</span><span class="w"> </span><span class="n">join_preload</span><span class="p" data-group-id="6762318847-3">(</span><span class="p" data-group-id="6762318847-4">[</span><span class="ss">:lines</span><span class="p" data-group-id="6762318847-4">]</span><span class="p" data-group-id="6762318847-3">)</span><span class="w">
</span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Repo</span><span class="o">.</span><span class="n">all</span><span class="p" data-group-id="6762318847-5">(</span><span class="p" data-group-id="6762318847-5">)</span></code></pre>
  </section>
</section>
<section class="detail" id="proload/3">

    <span id="proload/2"></span>

  <div class="detail-header">
    <a href="#proload/3" class="detail-link" title="Link to this macro">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this macro</span>
    </a>
    <h1 class="signature" translate="no">proload(query, qual \\ :left, associations)</h1>

      <a href="https://github.com/bonfire-networks/ecto_sparkles/blob/main/lib/ecto_sparkles.ex#L143" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


      <span class="note">(macro)</span>

  </div>

  <section class="docstring">

<p>AKA <code class="inline">join_preload++</code>. It's more powerful, but it does it with more (and different!) syntax.</p><p>e.g.</p><pre><code class="makeup elixir" translate="no"><span class="n">proload</span><span class="p" data-group-id="2197308284-1">(</span><span class="n">query</span><span class="p">,</span><span class="w"> </span><span class="ss">activity</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="2197308284-2">[</span><span class="w">
  </span><span class="ss">:verb</span><span class="p">,</span><span class="w"> </span><span class="ss">:boost_count</span><span class="p">,</span><span class="w"> </span><span class="ss">:like_count</span><span class="p">,</span><span class="w"> </span><span class="ss">:replied</span><span class="p">,</span><span class="w">
  </span><span class="c1"># relations under object will have their aliases prefixed with object_, i.e.</span><span class="w">
  </span><span class="c1"># :object_message, :object_post, :object_post_content</span><span class="w">
  </span><span class="c1"># the original names will still be used for the associations.</span><span class="w">
  </span><span class="ss">object</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="2197308284-3">{</span><span class="s">&quot;object_&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2197308284-4">[</span><span class="ss">:message</span><span class="p">,</span><span class="w"> </span><span class="ss">:post</span><span class="p">,</span><span class="w"> </span><span class="ss">:post_content</span><span class="p" data-group-id="2197308284-4">]</span><span class="p" data-group-id="2197308284-3">}</span><span class="w">
</span><span class="p" data-group-id="2197308284-2">]</span><span class="p" data-group-id="2197308284-1">)</span></code></pre>
  </section>
</section>
<section class="detail" id="query_filter/4">

    <span id="query_filter/2"></span>

    <span id="query_filter/3"></span>

  <div class="detail-header">
    <a href="#query_filter/4" class="detail-link" title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">query_filter(module_or_query, filters, order_by_prop \\ :id, order_direction \\ :desc)</h1>

      <a href="https://github.com/bonfire-networks/ecto_sparkles/blob/main/lib/ecto_sparkles.ex#L41" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">


  </section>
</section>
<section class="detail" id="reusable_join/5">

    <span id="reusable_join/4"></span>

  <div class="detail-header">
    <a href="#reusable_join/5" class="detail-link" title="Link to this macro">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this macro</span>
    </a>
    <h1 class="signature" translate="no">reusable_join(query, qual \\ :left, bindings, expr, opts)</h1>

      <a href="https://github.com/bonfire-networks/ecto_sparkles/blob/main/lib/ecto_sparkles.ex#L290" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


      <span class="note">(macro)</span>

  </div>

  <section class="docstring">

<p><code class="inline">reusable_join</code> is similar to <code class="inline">Ecto.Query.join/{4,5}</code>, but can be called multiple times with the same alias.</p><p>Note that only the first join operation is performed, the subsequent ones that use the same alias
are just ignored. Also note that because of this behaviour, it is mandatory to specify an alias when
using this function.</p><p>This is helpful when you need to perform a join while building queries one filter at a time,
because the same filter could be used multiple times or you could have multiple filters that
require the same join, which poses a problem with how the <code class="inline">filter/3</code> callback work, as you
need to return a dynamic with the filtering, which means that the join must have an alias,
and by default Ecto raises an error when you add multiple joins with the same alias.</p><p>To solve this, it is recommended to use this macro instead of the default <code class="inline">Ecto.Query.join/{4,5}</code>,
in which case there will be only one join in the query that can be reused by multiple filters.</p>
  </section>
</section>

    </div>
  </section>

      <footer class="footer">
        <p>

          <span class="line">
            <button class="a-main footer-button display-quick-switch" title="Search HexDocs packages">
              Search HexDocs
            </button>

              <a href="bonfire_umbrella.epub" title="ePub version">
                Download ePub version
              </a>

          </span>
        </p>

        <p class="built-using">
          Built using
          <a href="https://github.com/elixir-lang/ex_doc" title="ExDoc" target="_blank" rel="help noopener" translate="no">ExDoc</a> (v0.30.3) for the

            <a href="https://elixir-lang.org" title="Elixir" target="_blank" translate="no">Elixir programming language</a>

        </p>
      </footer>
    </div>
  </div>
</section>
</div>


  </body>
</html>
